<div class="forgot-password-container">
  <div class="forgot-password-wrapper">
    <div class="forgot-password-header">
     <div class="logo">
        <svg class="logo-img" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="#2563eb" stroke-width="2" stroke-linejoin="round"/>
          <path d="M2 17L12 22L22 17" stroke="#2563eb" stroke-width="2" stroke-linejoin="round"/>
          <path d="M2 12L12 17L22 12" stroke="#2563eb" stroke-width="2" stroke-linejoin="round"/>
        </svg>
      </div>
      <h1 class="forgot-password-title">Recuperar Contraseña</h1>
      <p class="forgot-password-subtitle">Sistema de Gestión de Materiales</p>
    </div>

    <!-- Mensaje de error -->
    @if (error()) {
      <div class="error-container">
        <app-error-message
          [title]="'Error'"
          [message]="error()!"
          [closeable]="true"
          [showRetry]="false"
          (close)="onErrorClose()">
        </app-error-message>
      </div>
    }

    <nz-card class="forgot-password-card" [nzBordered]="false">
      
      <!-- Formulario -->
      @if (!emailSent()) {
        <div class="form-content">
          <div class="instruction-text">
            <p>Ingresa tu dirección de correo electrónico y te enviaremos las instrucciones para restablecer tu contraseña.</p>
          </div>

          <form nz-form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()" class="forgot-password-form">
            
            <!-- Campo Email -->
            <nz-form-item>
              <nz-form-label nzRequired>Correo Electrónico</nz-form-label>
              <nz-form-control 
                [nzErrorTip]="hasFieldError('email') ? getFieldError('email') : ''">
                <nz-input-group nzPrefixIcon="mail">
                  <input 
                    nz-input 
                    type="email"
                    formControlName="email" 
                    placeholder="ejemplo@correo.com"
                    autocomplete="email"
                    [class.error-input]="hasFieldError('email')">
                </nz-input-group>
              </nz-form-control>
            </nz-form-item>

            <!-- Botón enviar -->
            <nz-form-item>
              <button 
                nz-button 
                nzType="primary" 
                nzSize="large"
                nzBlock
                [nzLoading]="loading()"
                [disabled]="!forgotPasswordForm.valid"
                type="submit"
                class="submit-button">
                <i nz-icon nzType="mail" nzTheme="outline"></i>
                <span>Enviar Instrucciones</span>
              </button>
            </nz-form-item>

            <!-- Link al login -->
            <div class="back-to-login">
              <a 
                class="login-link" 
                (click)="goToLogin()">
                <i nz-icon nzType="arrow-left" nzTheme="outline"></i>
                Volver al inicio de sesión
              </a>
            </div>
          </form>
        </div>
      }

      <!-- Confirmación de envío -->
      @if (emailSent()) {
        <div class="success-content">
          <nz-result
            nzStatus="success"
            nzTitle="¡Correo Enviado!"
            [nzSubTitle]="'Hemos enviado las instrucciones para restablecer tu contraseña a ' + forgotPasswordForm.get('email')?.value">
            
            <div nz-result-content>
              <div class="success-instructions">
                <h4>¿Qué hacer ahora?</h4>
                <ol>
                  <li>Revisa tu bandeja de entrada</li>
                  <li>Busca un correo de "Sistema de Gestión de Materiales"</li>
                  <li>Sigue las instrucciones en el correo</li>
                  <li>Si no lo encuentras, revisa tu carpeta de spam</li>
                </ol>
              </div>
            </div>

            <div nz-result-extra class="result-actions">
              <button 
                nz-button 
                nzType="primary" 
                (click)="goToLogin()">
                <i nz-icon nzType="login" nzTheme="outline"></i>
                Ir al Login
              </button>
              
              <button 
                nz-button 
                nzType="default" 
                [nzLoading]="loading()"
                (click)="resendEmail()">
                <i nz-icon nzType="mail" nzTheme="outline"></i>
                Reenviar Correo
              </button>
            </div>
          </nz-result>
        </div>
      }
    </nz-card>

    <!-- Footer -->
    <div class="forgot-password-footer">
      <p>&copy; {{ currentYear }} Sistema de Gestión de Materiales. Todos los derechos reservados.</p>
    </div>
  </div>
</div>